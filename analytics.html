<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Analytics</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}

body{
  margin:0;
  font-family:Candara, Calibri, Segoe, sans-serif;
  background:linear-gradient(180deg,#020617,#0f172a);
  color:#e5e7eb;
  padding:20px;
}

.container{max-width:1200px;margin:auto}

.money{
  font-family:Cambria,"Cambria Math",serif;
  font-weight:800;
}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:25px;
}

.header a{
  background:linear-gradient(135deg,#2563eb,#38bdf8);
  color:white;
  padding:8px 16px;
  border-radius:999px;
  text-decoration:none;
  font-size:14px;
}

/* SUMMARY CARDS */
.summary{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
  margin-bottom:30px;
}

.card{
  padding:20px;
  border-radius:18px;
  color:white;
  box-shadow:0 15px 35px rgba(0,0,0,.45);
  position:relative;
  overflow:hidden;
}

.card::after{
  content:"";
  position:absolute;
  width:120px;
  height:120px;
  border-radius:50%;
  top:-40px;
  right:-40px;
  background:rgba(255,255,255,.15);
}

.card small{opacity:.85}
.card span{font-size:26px}

/* CARD COLORS */
.in{background:linear-gradient(135deg,#16a34a,#4ade80)}
.out{background:linear-gradient(135deg,#dc2626,#fb7185)}
.max{background:linear-gradient(135deg,#7c3aed,#a78bfa)}
.avg{background:linear-gradient(135deg,#0ea5e9,#38bdf8)}

/* CHARTS */
.charts{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:20px;
  margin-bottom:30px;
}

.chart-box{
  background:#020617;
  border-radius:20px;
  padding:20px;
  box-shadow:0 15px 35px rgba(0,0,0,.6);
  border:2px solid transparent;
}

.chart-inout{border-color:#22c55e}
.chart-cat{border-color:#38bdf8}

/* TABLE */
.table-box{
  background:#020617;
  border-radius:20px;
  overflow:hidden;
  box-shadow:0 15px 35px rgba(0,0,0,.6);
  border:2px solid #1e293b;
}

table{width:100%;border-collapse:collapse}
thead{background:linear-gradient(135deg,#2563eb,#38bdf8)}

th{
  padding:12px;
  font-size:13px;
  text-align:left;
}

td{
  padding:14px;
  font-size:14px;
  border-bottom:1px solid #1e293b;
}

/* COLORFUL OUTLINES */
.col-date{border-left:5px solid #38bdf8}
.col-type{border-left:5px solid #22c55e}
.col-cat{border-left:5px solid #0ea5e9}
.col-amt{border-left:5px solid #fb7185}
.col-note{border-left:5px solid #94a3b8}

.inTxt{color:#4ade80;font-weight:700}
.outTxt{color:#fb7185;font-weight:700}

/* MOBILE */
@media(max-width:900px){
  .summary{grid-template-columns:repeat(2,1fr)}
  .charts{grid-template-columns:1fr}
}

@media(max-width:500px){
  body{padding:14px}
  .summary{grid-template-columns:1fr}
  th,td{font-size:12px}
}
</style>
</head>

<body>
<div class="container">

<div class="header">
  <h2>Analytics & Summary</h2>
  <a href="index.html">← Dashboard</a>
</div>

<!-- SUMMARY -->
<div class="summary">
  <div class="card in">
    <small>Total Income</small><br>
    ₹ <span id="totalIn" class="money">0</span>
  </div>

  <div class="card out">
    <small>Total Expense</small><br>
    ₹ <span id="totalOut" class="money">0</span>
  </div>

  <div class="card max">
    <small>Highest Expense</small><br>
    ₹ <span id="maxOut" class="money">0</span>
  </div>

  <div class="card avg">
    <small>Avg Daily Spend</small><br>
    ₹ <span id="avgSpend" class="money">0</span>
  </div>
</div>

<!-- CHARTS -->
<div class="charts">
  <div class="chart-box chart-inout">
    <h4>IN vs OUT</h4>
    <canvas id="inOutChart"></canvas>
  </div>

  <div class="chart-box chart-cat">
    <h4>Category-wise Expense</h4>
    <canvas id="categoryChart"></canvas>
  </div>
</div>

<!-- TABLE -->
<div class="table-box">
<table>
<thead>
<tr>
  <th>Date</th>
  <th>Type</th>
  <th>Category</th>
  <th>Amount</th>
  <th>Note</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>
</div>

</div>

<script>
const API_URL="https://script.google.com/macros/s/AKfycbyucNg-_rXfdnIsHQf_XnitffZtS4KdLNkqyrMGUCUKWM1fWGimkrTpA-KBWicRHfsVwA/exec";

let transactions=[],inOutChart,categoryChart;

async function fetchTransactions(){
  const res=await fetch(API_URL);
  transactions=await res.json();
  calculate();
}

function calculate(){
  let totalIn=0,totalOut=0,maxOut=0;
  const days=new Set();
  const categorySum={};

  transactions.forEach(t=>{
    if(t.type==="IN"){
      totalIn+=+t.amount;
    }else{
      totalOut+=+t.amount;
      maxOut=Math.max(maxOut,+t.amount);
      categorySum[t.category]=(categorySum[t.category]||0)+ +t.amount;
    }
    days.add(t.date);
  });

  totalInEl.textContent=totalIn;
  totalOutEl.textContent=totalOut;
  maxOutEl.textContent=maxOut;
  avgSpendEl.textContent=days.size?Math.round(totalOut/days.size):0;

  renderCharts(totalIn,totalOut,categorySum);
  renderTable();
}

function renderCharts(tin,tout,cat){
  if(inOutChart) inOutChart.destroy();
  if(categoryChart) categoryChart.destroy();

  inOutChart=new Chart(inOutChartEl,{
    type:"doughnut",
    data:{
      labels:["IN","OUT"],
      datasets:[{
        data:[tin,tout],
        backgroundColor:["#22c55e","#fb7185"]
      }]
    }
  });

  categoryChart=new Chart(categoryChartEl,{
    type:"bar",
    data:{
      labels:Object.keys(cat),
      datasets:[{
        data:Object.values(cat),
        backgroundColor:"#38bdf8"
      }]
    }
  });
}

function renderTable(){
  table.innerHTML="";
  transactions.slice(0,10).forEach(t=>{
    table.innerHTML+=`
      <tr>
        <td class="col-date">${t.date}</td>
        <td class="col-type ${t.type==="IN"?"inTxt":"outTxt"}">${t.type}</td>
        <td class="col-cat">${t.category}</td>
        <td class="col-amt money">₹${t.amount}</td>
        <td class="col-note">${t.note||"-"}</td>
      </tr>
    `;
  });
}

/* SHORTCUT IDs */
const totalInEl=totalIn;
const totalOutEl=totalOut;
const maxOutEl=maxOut;
const avgSpendEl=avgSpend;
const inOutChartEl=document.getElementById("inOutChart");
const categoryChartEl=document.getElementById("categoryChart");

fetchTransactions();
</script>
</body>
</html>
