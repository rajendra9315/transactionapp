<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Analytics</title>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{box-sizing:border-box}

/* FONTS */
body{
  margin:0;
  font-family:Candara, Calibri, Segoe, sans-serif;
  background:#f6f7fb;
  color:#1f2937;
  padding:30px;
}

.money{
  font-family:Cambria, "Cambria Math", serif;
  font-weight:700;
}

.container{max-width:1200px;margin:auto}

/* HEADER */
.header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:25px;
}

.header a{
  text-decoration:none;
  background:#2563eb;
  color:white;
  padding:8px 14px;
  border-radius:999px;
  font-size:14px;
}

/* SUMMARY CARDS */
.summary{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:16px;
  margin-bottom:30px;
}

.card{
  background:white;
  padding:18px;
  border-radius:14px;
  box-shadow:0 6px 18px rgba(0,0,0,.08);
}

.card small{color:#6b7280}
.card span{font-size:22px}

/* CHARTS */
.charts{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:20px;
  margin-bottom:35px;
}

.chart-box{
  background:white;
  padding:20px;
  border-radius:16px;
  box-shadow:0 8px 22px rgba(0,0,0,.10);
}

/* TABLE */
.table-box{
  background:white;
  border-radius:16px;
  overflow:hidden;
  box-shadow:0 8px 22px rgba(0,0,0,.10);
}

table{
  width:100%;
  border-collapse:collapse;
}

thead{background:#2563eb}

th{
  color:white;
  padding:12px;
  font-size:13px;
  text-align:left;
}

/* COLORED COLUMN BORDERS */
.col-date{border-left:5px solid #2563eb}
.col-type{border-left:5px solid #16a34a}
.col-cat{border-left:5px solid #0f766e}
.col-amt{border-left:5px solid #dc2626}
.col-note{border-left:5px solid #6b7280}

td{
  padding:14px;
  font-size:14px;
}

tbody tr{border-bottom:1px solid #e5e7eb}

.in{color:#16a34a;font-weight:700}
.out{color:#dc2626;font-weight:700}
</style>
</head>

<body>

<div class="container">

<!-- HEADER -->
<div class="header">
  <h2>Analytics & Summary</h2>
  <a href="index.html">‚Üê Dashboard</a>
</div>

<!-- SUMMARY -->
<div class="summary">
  <div class="card">
    <small>Total Income</small><br>
    ‚Çπ <span id="totalIn" class="money">0</span>
  </div>
  <div class="card">
    <small>Total Expense</small><br>
    ‚Çπ <span id="totalOut" class="money">0</span>
  </div>
  <div class="card">
    <small>Highest Expense</small><br>
    ‚Çπ <span id="maxOut" class="money">0</span>
  </div>
  <div class="card">
    <small>Avg Daily Spend</small><br>
    ‚Çπ <span id="avgSpend" class="money">0</span>
  </div>
</div>

<!-- CHARTS -->
<div class="charts">
  <div class="chart-box">
    <h4>IN vs OUT</h4>
    <canvas id="inOutChart"></canvas>
  </div>

  <div class="chart-box">
    <h4>Category-wise Spend</h4>
    <canvas id="categoryChart"></canvas>
  </div>
</div>

<!-- TABLE -->
<div class="table-box">
<table>
<thead>
<tr>
  <th>Date</th>
  <th>Type</th>
  <th>Category</th>
  <th>Amount</th>
  <th>Note</th>
</tr>
</thead>
<tbody id="table"></tbody>
</table>
</div>

</div>

<script>
/* =================================================
   üî¥ PASTE GOOGLE WEB APP URL HERE
   ================================================= */
const API_URL = "PASTE_GOOGLE_WEB_APP_URL_HERE";
/* Example:
const API_URL = "https://script.google.com/macros/s/AKfycbxxxx/exec";
*/

let transactions = [];
let inOutChart, categoryChart;

/* FETCH DATA FROM GOOGLE */
async function fetchTransactions(){
  const res = await fetch(API_URL);
  transactions = await res.json();
  calculate();
}

/* CALCULATIONS + RENDER */
function calculate(){
  let totalIn = 0, totalOut = 0, maxOut = 0;
  const days = new Set();
  const categorySum = {};

  transactions.forEach(t=>{
    if(t.type==="IN"){
      totalIn += +t.amount;
    }else{
      totalOut += +t.amount;
      maxOut = Math.max(maxOut, +t.amount);
      categorySum[t.category] = (categorySum[t.category] || 0) + +t.amount;
    }
    days.add(t.date);
  });

  document.getElementById("totalIn").textContent = totalIn;
  document.getElementById("totalOut").textContent = totalOut;
  document.getElementById("maxOut").textContent = maxOut;
  document.getElementById("avgSpend").textContent =
    days.size ? Math.round(totalOut / days.size) : 0;

  renderCharts(totalIn, totalOut, categorySum);
  renderTable();
}

/* CHARTS */
function renderCharts(totalIn, totalOut, categorySum){
  if(inOutChart) inOutChart.destroy();
  if(categoryChart) categoryChart.destroy();

  inOutChart = new Chart(document.getElementById("inOutChart"),{
    type:"doughnut",
    data:{
      labels:["IN","OUT"],
      datasets:[{
        data:[totalIn,totalOut],
        backgroundColor:["#16a34a","#dc2626"]
      }]
    }
  });

  categoryChart = new Chart(document.getElementById("categoryChart"),{
    type:"bar",
    data:{
      labels:Object.keys(categorySum),
      datasets:[{
        label:"Amount",
        data:Object.values(categorySum),
        backgroundColor:"#2563eb"
      }]
    }
  });
}

/* TABLE */
function renderTable(){
  table.innerHTML="";
  transactions.slice(0,10).forEach(t=>{
    table.innerHTML += `
      <tr>
        <td class="col-date">${t.date}</td>
        <td class="col-type ${t.type==="IN"?"in":"out"}">${t.type}</td>
        <td class="col-cat">${t.category}</td>
        <td class="col-amt money">‚Çπ${t.amount}</td>
        <td class="col-note">${t.note}</td>
      </tr>
    `;
  });
}

/* INIT */
fetchTransactions();
</script>

</body>
</html>
